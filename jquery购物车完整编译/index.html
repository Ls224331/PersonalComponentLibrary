<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-wap-web-app-capable" content="yes">
		<meta name="apple-wap-web-app-status-bar-style" content="black-translucent">
		<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
		<!-- ionic框架  css -->
		<link href="css/weixin.css" rel="stylesheet" type="text/css" />
		<link href="css/ionic.min.css" rel="stylesheet" type="text/css" />
		<link href="css/signin.css" rel="stylesheet" type="text/css" />
		<link href="css/share.css" rel="stylesheet" type="text/css" />
		<link href="css/index.css" rel="stylesheet" type="text/css" />
		<link rel="stylesheet" type="text/css" href="../css/mui.css" />
		<link rel="stylesheet" type="text/css" href="../fonts/iconfont.css" />
		<!-- ionic框架  js   -->
		<script type="text/javascript" src="js/ionic.bundle.min.js"></script>

		<script type="text/javascript" src="js/runend.js"></script>
		<script>
		</script>
		<style>
			body {
				background: #fff;
			}
		</style>

		<script type="text/javascript">
			//定义全局变量
			var i = 0;

			//金额总和
			var money = 0;

			//计算合计价格
			var cart_money = new Object();

			//全部商品ID
			var cart_id = new Object();
			//备份商品ID，用于全选后去掉全选又再次全选
			var cart_id_copy = new Object();
		</script>
	</head>

	<body>

		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#fff;font-size:40px;"></a>
		<div class="header_box" style="width:100%;height:140px;background-image:url(../img/LSimg/cartbg.png);background-size:100% 100%;">
			<div class="myTitle">
				<div class="cart">
					<div class="cartt">购物车</div>
					<div class="zongji">共计3件商品</div>
				</div>
				<div>
					<a class="rig_shai" id="rem_s" href="javascript:void(0)" style="margin-right:19px;font-size:15px;color:#fff;">管理</a>
				</div>

			</div>

		</div>

		<!-- <div style="height:200px;"></div> -->

		<form method="post" class="myForm" name="cart_form" target="_self" id="cart_form" action="" style="position: relative;top:-33px;width:95%;margin:0 auto;border-radius:10px;">

			<!--商品列表-->
			<div class="commodity_box" style="border:1px solid #C4C4C4;border-radius:10px;margin-bottom:13px;">
				<div class="commodity_list" style="border-radius: 10px;">
					<!--店名信息-->
					<div class="tite_tim select">
						<em aem="1" cart_id="84"></em>
						<span style="color:#4A4A4A;font-size:15px;font-weight: 600;display: flex;">证书 &nbsp; <p style="color:#4A4A4A;" class="iconfont iconqianjin">	</p> </span>
						<div class="clear"></div>
					</div>
					<!--商品-->
					<ul class="commodity_list_term">
						<li class="select" style="display: flex;">
							<em aem="0" cart_id="84"></em>
							<img style="width:70px;height:93px;border-radius:5px;" src="../img/LSimg/cartbook.png" />
							<div class="div_center" style="margin-left:26px;">
								<span class="yichu" style="color:#4A4A4A;font-size:14px;font-weight:600;">北师大家庭教育指导证书水电费双方都水电费第三方士大夫是的范德萨</span>
								<span style="border-radius: 4px;background: #BBBBBB;font-size:12px;padding:2px;color:#ECECEC;">仁仁家教育集团</span>
								<p style="margin-top:9px;" class="now_value"><i>￥</i><b class="qu_su">123.00</b></p>
							</div>
							<div style="float: left;display: flex;flex-direction: column;margin-left:10px;width:26px;height:90px;border-radius: 18px;background: #F3F3F3;text-align: center;">
								<i style="font-size:24px;color: #9E9E9E;margin-top:8px;" onclick="plusw(this)">+</i>
								<span style="font-size:15px;width:22px;height:22px;text-align: center;line-height: 22px;color:#fff;border-radius: 50%;background: #FFCA47;margin-left:2px;margin-top:6px;" class="zi">1</span>
								<input type="hidden" value="84">

								<i style="font-size:24px;color: #9E9E9E;margin-top:8px;" onclick="reducew(this)">-</i>
							</div>
							<!-- <div class="div_right">
							<i onclick="reducew(this)">-</i>
							<span class="zi">1</span>
							<input type="hidden" value="84">
							<i onclick="plusw(this)">+</i>
						</div> -->
						</li>
						<!-- <li class="select">
						<em aem="0" cart_id="84"></em>
						<img style="width:70px;height:93px;border-radius:5px;" src="../img/LSimg/cartbook1.png" />
						<div class="div_center" style="margin-left:26px;">
							<span class="yichu" style="color:#4A4A4A;font-size:14px;font-weight:600;">思维财富</span>
							<span  style="border-radius: 4px;background: #BBBBBB;font-size:12px;padding:2px;color:#ECECEC;">仁仁家教育集团</span>
							<p style="margin-top:9px;" class="now_value"><i>￥</i><b class="qu_su">25.00</b></p>
						</div>
						<div style="float: left;display: flex;flex-direction: column;margin-left:10px;width:26px;height:90px;border-radius: 18px;background: #F3F3F3;text-align: center;">
								<i style="font-size:24px;color: #9E9E9E;margin-top:8px;" onclick="plusw(this)">+</i>
								<span style="font-size:15px;width:22px;height:22px;text-align: center;line-height: 22px;color:#fff;border-radius: 50%;background: #FFCA47;margin-left:2px;margin-top:6px;" class="zi">1</span>
								<input type="hidden" value="84">
								
								<i style="font-size:24px;color: #9E9E9E;margin-top:8px;" onclick="reducew(this)">-</i>
						</div>
					</li> -->
					</ul>
					<!--优惠信息-->
					<!-- <div class="shop_ul_bottom account_info_box">
					<ul class="account_info">
					
						<li class="i_text">
							<span class="info_name xi_cu">包邮</span>
							<span class="info_name">商家包邮</span>
						</li>
												
					</ul>
				</div> -->
				</div>
			</div>

			<div class="commodity_box" style="border:1px solid #C4C4C4;border-radius:10px;margin-bottom:13px;">
				<div class="commodity_list" style="border-radius: 10px;">

					<div class="tite_tim select">
						<em aem="1" cart_id="84"></em>
						<span style="color:#4A4A4A;font-size:15px;font-weight: 600;">书籍 &nbsp;></span>
						<div class="clear"></div>
					</div>

					<ul class="commodity_list_term">
						<li class="select" style="display: flex;">
							<em aem="0" cart_id="84"></em>
							<img style="width:70px;height:93px;border-radius:5px;" src="../img/LSimg/cartbook.png" />
							<div class="div_center" style="margin-left:26px;">
								<span class="yichu" style="color:#4A4A4A;font-size:14px;font-weight:600;">北师大家庭教育指导证书水电费双方都</span>
								<span style="border-radius: 4px;background: #BBBBBB;font-size:12px;padding:2px;color:#ECECEC;">仁仁家教育集团</span>
								<p style="margin-top:9px;" class="now_value"><i>￥</i><b class="qu_su">123.00</b></p>
							</div>
							<div style="float: left;display: flex;flex-direction: column;margin-left:10px;width:26px;height:90px;border-radius: 18px;background: #F3F3F3;text-align: center;">
								<i style="font-size:24px;color: #9E9E9E;margin-top:8px;" onclick="plusw(this)">+</i>
								<span style="font-size:15px;width:22px;height:22px;text-align: center;line-height: 22px;color:#fff;border-radius: 50%;background: #FFCA47;margin-left:2px;margin-top:6px;" class="zi">1</span>
								<input type="hidden" value="84">

								<i style="font-size:24px;color: #9E9E9E;margin-top:8px;" onclick="reducew(this)">-</i>
							</div>

						</li>
						<li class="select" style="display: flex;">
							<em aem="0" cart_id="84"></em>
							<img style="width:70px;height:93px;border-radius:5px;" src="../img/LSimg/cartbook1.png" />
							<div class="div_center" style="margin-left:26px;">
								<span class="yichu" style="color:#4A4A4A;font-size:14px;font-weight:600;">养成教育丛书</span>
								<span style="border-radius: 4px;background: #BBBBBB;font-size:12px;padding:2px;color:#ECECEC;">仁仁家教育集团</span>
								<p style="margin-top:9px;" class="now_value"><i>￥</i><b class="qu_su">25.00</b></p>
							</div>
							<div style="float: left;display: flex;flex-direction: column;margin-left:10px;width:26px;height:90px;border-radius: 18px;background: #F3F3F3;text-align: center;">
								<i style="font-size:24px;color: #9E9E9E;margin-top:8px;" onclick="plusw(this)">+</i>
								<span style="font-size:15px;width:22px;height:22px;text-align: center;line-height: 22px;color:#fff;border-radius: 50%;background: #FFCA47;margin-left:2px;margin-top:6px;" class="zi">1</span>
								<input type="hidden" value="84">

								<i style="font-size:24px;color: #9E9E9E;margin-top:8px;" onclick="reducew(this)">-</i>
							</div>
						</li>
					</ul>

				</div>
			</div>
			<!-- <div class="commodity_box">
			<div class="commodity_list">
				
				<div class="tite_tim select">
					<em aem="1" cart_id="84"></em>
					<span>momo</span>
					<div class="clear"></div>
				</div>
			
				<ul class="commodity_list_term">
					<li class="select">
						<em aem="0" cart_id="84"></em>
						<img src="images/33d332dbca4e027fbc270db34a1a915d.png" />
						<div class="div_center">
							<h4>新疆苹果</h4>
							<span>50斤</span>
							<p class="now_value"><i>￥</i><b class="qu_su">210.00</b></p>
						</div>
						<div class="div_right">
							<i onclick="reducew(this)">-</i>
							<span class="zi">1</span>
							<input type="hidden" value="84">
							<i onclick="plusw(this)">+</i>
						</div>
					</li>
					<li class="select">
						<em aem="0" cart_id="84"></em>
						<img src="images/33d332dbca4e027fbc270db34a1a915d.png" />
						<div class="div_center">
							<h4>新疆苹果</h4>
							<span>50斤</span>
							<p class="now_value"><i>￥</i><b class="qu_su">412.00</b></p>
						</div>
						<div class="div_right">
							<i onclick="reducew(this)">-</i>
							<span class="zi">1</span>
							<input type="hidden" value="84">
							<i onclick="plusw(this)">+</i>
						</div>
					</li>
				</ul>
			
				<div class="shop_ul_bottom account_info_box">
					<ul class="account_info">
					
						<li class="i_text">
							<span class="info_name xi_cu">包邮</span>
							<span class="info_name">商家包邮</span>
						</li>
												
					</ul>
				</div>
			</div>
		</div> -->

			</div>
			<!-- end -->

			<!-- footer -->
			<div style="height:55px;"></div>
			<div class="settle_box" style="display: flex;justify-content: space-between;">

				<dl class="all_check select">
					<dt><span id="all_pitch_on"></span><i style="margin-left:10px;font-weight: 400;">全选</i></dt>
				</dl>
				<div style="display: flex;align-items: center;">
					<dl class="" style="display: flex;margin-bottom:0;margin-right:20px;margin-top:10px;">
						<dt style="font-size:14px;display: flex;color:#333;">合计：<p id="total_price" style="color:#FFCA47">¥<b>0</b></p></dt>

					</dl>
					<input type="hidden" name="gcs" id="gcs" />
					<a style="border-radius: 24px;" class="settle_btn" href="javascript:void(0);" onclick="settlement()" id="confirm_cart">结算</a>
					<a style="border-radius: 24px;" class="settle_btn" href="javascript:void(0);" id="confirm_cart1" onclick="big_cart_remove()">删除</a>
				</div>
			</div>
			<!-- end -->
		</form>
		<script type="text/javascript" src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/jquery.js"></script>
		<script type="text/javascript" src="../js/public.js"></script>
		<script type="text/javascript" src="index.js"></script>
		<script>
			mui.init({
				swipeBack: true //启用右滑关闭功能
			});
		</script>

		<script>
			var noX = 0; /* 没选中时点击加减计算数量  */
			var allThis = $(".commodity_box .select em"); /*底部全选*/
			var totalH = 0;
			var count;
			var catid = [0, ]
			var mynum;
			var myCount = 0
			var arr = []
			/* 减  */
			function reduceMod(e, totalH, mod, noX) {
				var tn = e.siblings().find(".qu_su").text(); /* 当前选中商品  */
				var tn1 = e.siblings().find(".zi").text(); /* 商品数量  */
				console.log(parseInt(tn1)) //当前操作减商品数量
				var cc = 0;
				$(".pitch_on").each(function(e) {
					var tem = $(this).parents("li").find(".zi").text()
					if(tem) {
						var num_tem = parseInt(tem);
						cc += num_tem
					}
				})
				console.log(cc)
				myCount = cc
				//				 $("#confirm_cart").html("结算("+myCount+")"); 
				bianshen()
				if(mod != 2) {
					var Total = parseFloat(totalH) - (tn * tn1); /* 总价格减该商品总数价格  */
					price = Total
					//	  			$("#total_price b").text(price.toFixed(2));
					bianshen()
				} else {
					/* 合计加单价-1 */
					var Total = parseFloat(totalH) - parseFloat(tn); /* 总价格减该商品总数价格  */
					price = Total
					//	  			$("#total_price b").text(price.toFixed(2));
					bianshen()
				}

			};
			var price = 0; //定义全局价格变量
			/* 加  */
			function plusMod(e, totalH, mod) {
				//			console.log(totalH)
				var tn = e.siblings().find(".qu_su").text(); /* 当前选中商品  */
				var tn1 = e.siblings().find(".zi").text(); /* 商品数量  */
				console.log(parseInt(tn1)) //当前操作商品数量

				var cc = 0;
				$(".pitch_on").each(function(e) {
					var tem = $(this).parents("li").find(".zi").text()
					if(tem) {
						var num_tem = parseInt(tem);
						cc += num_tem
					}
				})
				myCount = cc
				console.log(myCount)
				//				 $("#confirm_cart").html("结算("+myCount+")"); 
				bianshen()
				if(mod != 2) {
					var Total = parseFloat(totalH) + (tn * tn1); /* 总价格加上该商品总数价格  */
					console.log(totalH) //初始化价格变量为0.执行运算价格
					console.log(Total) //当前选中商品的总价格

					price += Total //每次点击选中商品将其当前总价格放入全局变量中
					console.log(price) //全局价格
					//$("#total_price b").text(price.toFixed(2));         //渲染
					bianshen()
				} else {
					/* 合计加单价+1 */
					var Total = parseFloat(totalH) + (parseFloat(tn) + (noX - 1)); /* 总价格加上该商品总数价格  */
					console.log(Total) //执行选中商品其中一个加数量方法后的全部总价
					console.log(parseFloat(tn) + (noX - 1))
					price = Total
					//	  			$("#total_price b").text(price.toFixed(2));
					bianshen()
				}

			};
			/*全选该店商品价格 加*/
			function commodityPlusMod(e, totalH) {
				var qu = e.parents(".commodity_list").find(".pitch_on").parent().find(".qu_su");
				var quj = e.parents(".commodity_list").find(".pitch_on").parent().find(".zi");
				console.log(JSON.stringify(qu))
				var Total = 0;
				var erTotal = true;
				/* 该商品全部金额  */
				for(var i = 0; i < qu.length; i++) {
					var n = qu.eq(i).text();
					var n1 = quj.eq(i).text();
					/*合计价格*/
					if(erTotal) {
						Total = parseFloat(totalH) + (parseFloat(n) * parseFloat(n1));
						if(Total < 0)
							Total = 0;
						erTotal = false;
					} else {
						Total = parseFloat(Total) + (parseFloat(n) * parseFloat(n1));

					}
				}
				console.log(price)
				console.log(Total)
				price = Total + price
				//$("#total_price b").text(price.toFixed(2)); /* 合计金额  */
				bianshen()
			};
			var plus;
			/*全选该店商品价格 减*/
			function commodityReduceMod(e, totalH) {
				var qu = e.parents(".commodity_list").find(".pitch_on").parent().find(".qu_su");
				var quj = e.parents(".commodity_list").find(".pitch_on").parent().find(".zi");
				// console.log(parseInt(qu))
				var Total = 0;
				plus = totalH;

				var erTotal = true;
				/* 该商品全部金额  */
				for(var i = 0; i < qu.length; i++) {
					var n = qu.eq(i).text();
					var n1 = quj.eq(i).text();
					/*合计价格*/
					if(erTotal) {
						Total = parseFloat(totalH) - (parseFloat(n) * parseFloat(n1));
						plus = Total;
						if(Total < 0)
							Total = 0;
						erTotal = false;
					} else {
						Total = parseFloat(Total) - (parseFloat(n) * parseFloat(n1));
						plus = Total;

					}
					console.log(price)
					console.log(Total)
					console.log(plus)
					//	$("#total_price b").text(price.toFixed(2)); /* 合计金额  */
					plus;
				}
				bianshen()
			};
			
			var mch_list = []         //全局商品id，数量集合
			var cid = 0
			//全局查找选中的商品数量，价格，总价，总数
			function bianshen() {
				var zong_count = 0;
				var zong_price = 0;
				var goods_list=[]
				var arr = []
				$('.pitch_on').each(function() {       //循环全局被选中商品
					console.log(222222222)
					var tn = $(this).siblings().find(".qu_su").text(); /* 当前全局选中商品价钱 */
					var tn1 = $(this).siblings().find(".zi").text(); /* 商品数量  */
					cid = $(this).attr("data-id");           //当前选中商品id
					console.log(cid)				 						
					console.log(parseInt(tn1))
					if(tn1) {
						zong_count += parseInt(tn1)          //整理全局被选中商品数量加加，
						zong_price += parseInt(tn) * parseInt(tn1)    //整理全局被选中商品价钱加加
						goods_list1 = {                             //将选中商品id和数量存成对象
							cart_id: cid,                //当前循环商品id
							num : tn1					//当前循环商品数量
						}   
						goods_list.push(goods_list1)           //将选中单个商品对象整理成数组集合
					}      
				})
				var fot = $(".pitch_on");
				console.log(fot.length)             //打印当前页面被选中的商品长度
				
				var array = {
					mch_id: '0',              //拼接数组格式需要
					goods_list: goods_list          //定义传递参数数据格式，将其拼接
				}
				arr.push(array)                //将拼接好的数据格式放入定义好的数组中，为向接口传递参数做准备
				console.log(JSON.stringify(goods_list))
				console.log(zong_count)
				console.log(zong_price)
				console.log(JSON.stringify(arr))
				mch_list = arr                   //将准备好的数据赋值给全局变量数组，准备传递
				$("#total_price b").text(zong_price.toFixed(2)); /* 合计金额  */
				$("#confirm_cart").html("结算(" + zong_count + ")"); //商品总数量
				console.log(JSON.stringify(mch_list))
			}
			/*全部商品价格*/
			function commodityWhole() {

				/* 合计金额  */
				var je = $(".commodity_box .select .qu_su"); /* 全部商品单价  */
				var je1 = $(".commodity_box .select .zi"); /* 全部商品数量  */
				console.log(je1)
				var TotalJe = 0;
				var count = 0;
				for(var i = 0; i < je.length; i++) {
					var n = je.eq(i).text();
					var n1 = je1.eq(i).text();
					TotalJe = TotalJe + (parseFloat(n) * parseFloat(n1));
					count = count + parseFloat(n1)
				}
				price = TotalJe //将得到的全选价格赋值给全局价格
				myCount = count
				console.log(00000)
				console.log(price)
				//$("#total_price b").text(price.toFixed(2)); /* 合计金额  */
				//$("#confirm_cart").html("结算("+myCount+")");    //商品总数量
			};

			//选择结算商品		  
			$(document).on("click", ".select em", function() {

				var su = $(this).attr("aem");
				console.log(price)
				console.log($(this).parents("li").find(".zi").text())
				//   totalH = $("#total_price b").text(); /* 合计金额  */
				//   var cid = this.getAttribute('data-id');
				//   catid.push("id"+":"+cid)
				//   for(var i =0;i<catid.length;i++){
				// 	  console.log(i.id)

				if(su == 0) { //su==0   点击商品选中按钮
					/* 单选商品  */
					if($(this).hasClass("pitch_on")) { //如果当前商品选中状态，移除选中	
						/*去该店全选*/
						$(this).parents("ul").siblings(".select").find("em").removeClass("pitch_on");
						console.log(myCount)

						//					根据数组的id的个数判断选中商品,点灭状态也要放入id以便查看长度
						var carts_id = $(this).attr("cart_id");
						var cid = this.getAttribute('data-id');
						for(i = 0; i < catid.length; i++) {
							console.log(2222)
							if(catid[i] == cid) {} else {
								catid.push(cid)
								break;
							} // break;
						}
						var map = {} //查看数组内当前商品id的个数
						console.log(catid)
						for(j = 0; j < catid.length; j++) {
							var ai = catid[j]
							if(!map[ai]) {
								map[ai] = 1;
							} else {
								map[ai]++
							}
							console.log(JSON.stringify(map))
						}
						arr = [] //清空重复的放入
						for(var p in map) { //如何商品id不为偶数，代表当前选中，将id放入数组内				 
							console.log(map[p])
							console.log(p)
							if(map[p] % 2 == 0) {

							} else {
								arr.push(p)

							}
						}
						console.log(JSON.stringify(arr)) //单选商品id集合
						//此处为移除选中时执行操作
						console.log(price)

						var tn = $(this).siblings().find(".qu_su").text(); /* 当前选中商品  */
						var tn1 = $(this).siblings().find(".zi").text(); /* 商品数量  */
						var Total = parseInt(tn) * parseInt(tn1);

						console.log(parseInt(tn))
						console.log(parseInt(tn1))
						console.log(parseInt(Total))

						price = price - Total //全局价格减去当前选中商品的数量和单价乘积

						console.log(price)
						myCount = myCount - parseInt(tn1) //全局数量减去当前选中商品数量
						//$("#total_price b").text(price.toFixed(2)); /* 合计金额  */     //渲染价格
						//$("#confirm_cart").html("结算("+myCount+")");    //商品总数量
						/*去底部全选*/
						$("#all_pitch_on").removeClass("pitch_on");
						$(this).removeClass("pitch_on");
						//					reduceMod($(this),totalH);
						cart_id[carts_id] = "";
						delete cart_id[carts_id];
						bianshen()
					} else { //否则代表选中商品，向选中商品的id集合中追加id

						var carts_id = $(this).attr("cart_id");
						var cid = this.getAttribute('data-id');
						for(i = 0; i < catid.length; i++) {
							console.log(2222)
							if(catid[i] == cid) {} else {
								catid.push(cid)
								break;
							} // break;
						}
						var map = {} //查看数组内当前商品id的个数
						console.log(catid)
						for(j = 0; j < catid.length; j++) {
							var ai = catid[j]
							if(!map[ai]) {
								map[ai] = 1;
							} else {
								map[ai]++
							}
							console.log(JSON.stringify(map))
						}
						arr = [] //清空重复的放入
						for(var p in map) { //如何商品id不为偶数，代表当前选中，将id放入数组内				 
							console.log(map[p])
							console.log(p)
							if(map[p] % 2 == 0) {

							} else {
								arr.push(p)

							}
						}
						console.log(JSON.stringify(arr)) //单选商品id集合

						//为商品追加选中状态
						$(this).addClass("pitch_on");
						var n = $(this).parents("ul").children().find(".pitch_on");
						var n1 = $(this).parents("ul").children();
						plusMod($(this), totalH, 0, noX);

						cart_id[carts_id] = "";
						/*该店商品全选中时*/
						if(n.length == n1.length) {
							$(this).parents("ul").siblings(".select").find("em").addClass("pitch_on");

						}
						/*商品全部选中时*/
						var fot = $(".pitch_on"); //如果当前选中的状态的个数
						var fot1 = $("em"); //等于选中标签的个数   代表全部选中
						console.log(JSON.stringify(fot.length))
						console.log(JSON.stringify(fot1.length))
						if(fot.length == fot1.length)
							$("#all_pitch_on").addClass("pitch_on"); //点亮全选标签
						//					  console.log(2222)
						bianshen()
					}
				} else { //em!=0   代表选中店铺
					var shop_count = 0
					var shop_price = 0
					/* 全选该店铺  */
					if($(this).hasClass("pitch_on")) { //如果店铺状态为选中，代表取消选中，移除状态
						/*去底部全选*/
						$("#all_pitch_on").removeClass("pitch_on");
						$(this).removeClass("pitch_on");
						console.log(shop_count)
						console.log(price)

						$(".pitch_on").each(function($e, $a) { //全选店铺将其下商品id存入id集合						
							var tn = $(this).siblings().find(".qu_su").text(); /* 当前选中商品  */
							var tn1 = $(this).siblings().find(".zi").text(); /* 商品数量  */
							console.log(parseInt(tn1))
							console.log(parseInt(tn))
							if(tn1) {
								shop_count += parseInt(tn1)
								shop_price += parseInt(tn) * parseInt(tn1)
							}
						})
						console.log(shop_count)
						console.log(shop_price)
						myCount = myCount - shop_count
						price = price - shop_price
						console.log(arr)
						console.log(myCount)
						// $("#confirm_cart").html("结算("+myCount+")");    //商品总数量  
						//$("#total_price b").text(price.toFixed(2)); /* 合计金额  */     //渲染价格

						commodityReduceMod($(this), totalH);
						$(this).parent().siblings("ul").find("em").removeClass("pitch_on");
						bianshen()
						delete cart_id[carts_id];
					} else { //否则代表没选中，添加状态
						commodityReduceMod($(this), totalH);

						$(this).addClass("pitch_on");

						$(this).parent().siblings("ul").find("em").addClass("pitch_on");
						arr = [] //清空选中商品id

						$(".pitch_on").each(function($e, $a) { //全选店铺将其下商品id存入id集合
							var b = $(this)[0].dataset.id;
							var tn = $(this).siblings().find(".qu_su").text(); /* 当前选中商品  */
							var tn1 = $(this).siblings().find(".zi").text(); /* 商品数量  */
							console.log(parseInt(tn1))
							if(tn1) {
								shop_count += parseInt(tn1)
							}

							// console.log(b)  
							arr.push(b)
						})
						console.log(shop_count)
						myCount = shop_count
						console.log(arr)
						console.log(myCount)
						//$("#confirm_cart").html("结算("+myCount+")");    //商品总数量
						/*if(plus != NaN && plus != undefined && plus > 0){
							totalH = parseFloat(totalH)-parseFloat(plus);
							if(totalH < 0)
								totalH = 0;
						}*/
						if(plus == undefined || plus == NaN) {
							plus = 0
						}

						commodityPlusMod($(this), plus);
						cart_id[carts_id] = "";
						/*商品全部选中时*/
						bianshen()
						var fot = $(".pitch_on");       //获取当前页面选中状态的长度
						var fot1 = $("em");				//获取当前页面可以进行选中标签的长度
						console.log(JSON.stringify(fot.length))
						 console.log(JSON.stringify(fot1.length))
						if(fot.length == fot1.length) {             //如果当前页面选中状态的长度等于可以进行选中标签的长度，点亮全选标签
							$("#all_pitch_on").addClass("pitch_on");
						}

					}
				}

				//计算选择数值
				number();

			});
			/* 底部全选  */

			var bot = 0;
			$(document).on("click", "#all_pitch_on", function() {
				//		  if($("#all_pitch_on").hasClass("pitch_on")){
				//		  	$("#all_pitch_on").removeClass("pitch_on")
				//		  	$('em').removeClass('pitcn_on')
				//		  }
				console.log(price)
				console.log(noX)
				// $("#all_pitch_on").click(function(){
				if(bot == 0) {
					$("em").addClass("pitch_on") //底部全选所有选中标签
					arr = [] //清空选中商品id
					$(".pitch_on").each(function($e, $a) {
						var b = $(this)[0].dataset.id;
						// console.log(b)
						arr.push(b)
					})
					console.log(arr)
					$(this).addClass("pitch_on");
					allThis.removeClass("pitch_on");
					allThis.addClass("pitch_on");
					/*总价格*/
					commodityWhole();
					bot = 1;
					//重新加入属性对象
					for(var key in cart_id_copy) {
						cart_id[key] = "";
					}
					bianshen()
				} else {

					$("em").removeClass("pitch_on");
					$("#confirm_cart").html("结算(" + 0 + ")");
					//底部取消全选标签的em
					$(this).removeClass("pitch_on");
					allThis.removeClass("pitch_on");
					$("#total_price b").text("0");
					bot = 0;
					price = 0;
					//移除全部对象
					for(var key in cart_id) {
						delete cart_id[key];
					}
					bianshen()
				}
				//计算选择数值
				//  number();
			});

			function number() {
				var num = 0;
				for(var key in cart_id) {
					num++;
				}
				//将选择的放入到计算里面
				//			$("#confirm_cart").html("结算("+num+")");   
			}

			/* 编辑商品  */
			var topb = 0;
			$("#rem_s").click(function() {
				if(topb == 0) {
					$(this).text("完成");
					$(".total_amount").hide(); /* 合计  */
					$("#confirm_cart").hide(); /* 结算  */
					$("#confirm_cart1").show(); /* 删除 */
					topb = 1;
				} else {
					topb = 0;
					$(this).text("管理");
					$(".total_amount").show(); /* 合计  */
					$("#confirm_cart").show(); /* 结算  */
					$("#confirm_cart1").hide(); /* 删除 */
					allThis.removeClass("pitch_on"); /* 取消所有选择  */
					$("#all_pitch_on").removeClass("pitch_on"); /* 取消所有选择  */
					$("#total_price b").text("0"); /*合计价格清零*/

				}

			});
			/* 加减  */

			function reducew(obj) {
				//减
				var $this = $(obj);
				var totalH = $("#total_price b").text(); /* 合计金额  */
				var ise = $this.siblings("span").text();
				var gc_id = $this.siblings("input").val();
				if(noX <= 0) {
					noX = 0;
				} else {
					noX--;
				};

				if(parseInt(ise) <= 1) {
					$this.siblings("span").text("1");
					bianshen()
				} else {
					var n = parseInt(ise) - 1;
					$this.siblings("span").text(n);
					if($this.parent().parent().children("em").hasClass("pitch_on")) {
						var mo = $this.parent().parent().children("em");
						reduceMod(mo, totalH, 2, noX);
						noX = 0;
					}
					bianshen()

				}

				//goods_count_adjust(gc_id,n,null);
			};

			function plusw(obj) {
				//加
				var $this = $(obj);
				var totalH = $("#total_price b").text(); /* 合计金额  */
				var ise = $this.siblings("span").text();
				var gc_id = $this.siblings("input").val();
				var n = parseInt(ise) + 1;
				noX++;

				$this.siblings("span").text(n);
				if($this.parent().parent().children("em").hasClass("pitch_on")) {
					var mo = $this.parent().parent().children("em");
					plusMod(mo, totalH, 2, noX);
					noX = 0;
				}
				bianshen()
				//goods_count_adjust(gc_id,n,null);
			}

			//删除 
			function big_cart_remove() {
				console.log(arr) //选中的集合
				$(".commodity_list_term .pitch_on").parent().remove();
				$(".commodity_list .tite_tim > em.pitch_on").parents(".commodity_box").remove();
				console.log(str + "r=api/cart/delete&catid=" + arr)
				$.ajax({
					type: "get",
					url: str + "r=api/cart/delete",
					dataType: "json",
					data: {
						cart_id_list: arr,
						access_token: "MIBjcvSZaGlOcaJnXOvzYP-tMJTdzqyA"
					},
					success: function(res) {
						console.log(JSON.stringify(res));
						catid = []
   
					}
				});
				bianshen()
			}
//			   结算
			function settlement(){
//			var mch_list = JSON.stringify(mch_list)
			console.log(JSON.stringify(mch_list))
			console.log(str + "r=api%2Forder%2Fnew-submit-preview&mch_list="+mch_list)
					$.ajax({
					type: "get",
					url: str + "r=api%2Forder%2Fnew-submit-preview",
					dataType: "json",  
					data: {
						mch_list:JSON.stringify(mch_list),
						access_token: "MIBjcvSZaGlOcaJnXOvzYP-tMJTdzqyA"
					},
					success: function(res) {
						console.log(JSON.stringify(res));
						
					}
				});
			}
		</script>
	</body>

</html>